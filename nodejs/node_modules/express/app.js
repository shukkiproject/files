//import modules
var express = require('express');
var path = require('path');
var bodyParser = require('body-parser');
var productsRouter = require('./src/routers/productsRouter');

//instance
var app = express();
var port = process.argv[2] || 1976;

//engine
app.set('view engine', 'jade');
app.set('views', path.join(__dirname, 'src/views'));

//middleware
//it will find everything in the public file automatically
app.use(express.static(path.join(__dirname,'public')));
// parse application/x-www-form-urlencoded 
app.use(bodyParser.urlencoded({ extended: false }));
 
// use json format
app.use(bodyParser.json());

app.use(function(req,res,next){
	console.log('time : ',Date.now().toLocaleString());
	next();
})

app.use(function(req,res,next){
	console.log('request type : '+ req.method);
	next();
})

app.use(function(req,res,next){
	console.log('there');
	next();
})

app.get('/', function(request, res){
	var user={
		name:"john",
		lastname:"doe",
		age: 25,
		tab:['foo', 'bar', 'baz', 'ohohohohooooh']
	};
	// response.send('racine');
	res.render('layout',{title:"Accueil",value:"un élément",user:user});
});

// if there's nothing to send back, it's a bad routing
app.use(function(req,res,next){
	console.log('Mauvaise Route');
	next();
})

app.use('/products', productsRouter);

app.listen(port, function(){
	console.log('Server is listening on port'+port);
});